# =========================================================
# -- GB 21/06/2023 ----------------------------------------
# Clean created records in tables from failing Cucumber tests
#==========================================================
Call OUVRE_TRACE("QLFAR_CLEAN_TABLES") From LECFIC
Call TESTSUITE()
Call FERME_TRACE From LECFIC
GTRACE = "QLFAR_CLEAN_TABLES_"+GACTX.USER
Call LEC_TRACE From LECFIC
End
# =======================================================================
#**
#* The main entry point of the unit test suite for table commands
#*
#*!
Funprog TESTSUITE()
#--- Remove Zombi records in tables ---
Call ADD_TESTCASE("CLEAN_ATABLE","Remove records from tables",3) From AXUNIT
Call ADD_TESTCASE("CLEAN_AVIEW", "Remove records from views", 20) From AXUNIT
Call ADD_TESTCASE("CLEAN_TABCOUNTRY","Remove records from TABCOUNTRY",2) From AXUNIT
Call ADD_TESTCASE("CLEAN_AUTILIS","Remove user parameters",5) From AXUNIT
Call ADD_TESTCASE("CLEAN_AOBJEXT","Remove records from Import/Export Template",4) From AXUNIT
Call ADD_TESTCASE("CLEAN_APACKAGE","Remove packages from APACKAGE",5) From AXUNIT
Call ADD_TESTCASE("CLEAN_AWRKLNK","Remove data models from AWRKLNK",2) From AXUNIT
Call ADD_TESTCASE("CLEAN_ANODEBDG","Remove binding data from ANODEBDG",1) From AXUNIT
Call ADD_TESTCASE("CLEAN_ACTIV","Remove activity codes",6) From AXUNIT
Call ADD_TESTCASE("CLEAN_AWRKPAR","Remove workflow parameters",5) From AXUNIT
# ======================================================================
Local Clbfile  SUITE_RESULT
SUITE_RESULT =func AXUNIT.RUN_TESTSUITE("Clean tables", "")
End SUITE_RESULT

#===========================================
Funprog IGNORE()
# This script is not intended to be run independently as part of the daily test plan.
End [V]CST_ATRUE

# =================================================
# Remove records from ATABLE
# =================================================
Subprog CLEAN_ATABLE()
Call CLEAN_RECORD("ATABLE","ATB","CODFIC","ZABANK")
Call CLEAN_RECORD("ATABZON","ATZ","CODFIC","ZABANK")
Call CLEAN_RECORD("ATABIND","ATI","CODFIC","ZABANK")
End

# =================================================
# Remove view records
# =================================================
Subprog CLEAN_AVIEW()
# AVIEW
Call CLEAN_RECORD("AVIEW","AVW","CODVUE","ZADICADX")
Call CLEAN_RECORD("AVIEW","AVW","CODVUE","ZAVIEWFLD")
Call CLEAN_RECORD("AVIEW","AVW","CODVUE","ZAVIEWIND")
Call CLEAN_RECORD("AVIEW","AVW","CODVUE","ZAVVTEXTRA")

# AVIEWB
Call CLEAN_RECORD("AVIEWB","AVB","CODVUE","ZADICADX")
Call CLEAN_RECORD("AVIEWB","AVB","CODVUE","ZAVIEWFLD")
Call CLEAN_RECORD("AVIEWB","AVB","CODVUE","ZAVIEWIND")
Call CLEAN_RECORD("AVIEWB","AVB","CODVUE","ZAVVTEXTRA")

# AVIEWC
Call CLEAN_RECORD("AVIEWC","AVC","CODVUE","ZADICADX")
Call CLEAN_RECORD("AVIEWC","AVC","CODVUE","ZAVIEWFLD")
Call CLEAN_RECORD("AVIEWC","AVC","CODVUE","ZAVIEWIND")
Call CLEAN_RECORD("AVIEWC","AVC","CODVUE","ZAVVTEXTRA")

# AVIEWD
Call CLEAN_RECORD("AVIEWD","AVD","CODVUE","ZADICADX")
Call CLEAN_RECORD("AVIEWD","AVD","CODVUE","ZAVIEWFLD")
Call CLEAN_RECORD("AVIEWD","AVD","CODVUE","ZAVIEWIND")
Call CLEAN_RECORD("AVIEWD","AVD","CODVUE","ZAVVTEXTRA")

# AVIEWE
Call CLEAN_RECORD("AVIEWE","AVE","CODVUE","ZADICADX")
Call CLEAN_RECORD("AVIEWE","AVE","CODVUE","ZAVIEWFLD")
Call CLEAN_RECORD("AVIEWE","AVE","CODVUE","ZAVIEWIND")
Call CLEAN_RECORD("AVIEWE","AVE","CODVUE","ZAVVTEXTRA")
End

# =================================================
# Remove records from TABCOUNTRY
# =================================================
Subprog CLEAN_TABCOUNTRY()
Call CLEAN_RECORD("TABCOUNTRY","TCY","CRY","ZFR")
Call CLEAN_RECORD("TABCOUNTRY","TCY","CRY","FRX")
End

# =================================================
# Remove user parameters
# =================================================
Subprog CLEAN_AUTILIS()
# AUTILIS
Call CLEAN_RECORD("AUTILIS","AUS","USR","ZDMIN")
# ACCES
Call CLEAN_RECORD("ACCES","ACC","USR","ZDMIN")
# ABLOB
Call CLEAN_RECORD("ABLOB","ABB","IDENT1","ZDMIN")
# ABLOB
Call CLEAN_RECORD("ATEXTRA","AXX","IDENT1","ZDMIN")
# ABLOB
Call CLEAN_RECORD("ADOVALAUS","ADU","CODUSR","ZDMIN")
End

# =================================================
# Remove import/export templates
# =================================================
Subprog CLEAN_AOBJEXT()
# ABOJTXT
Call CLEAN_RECORD("AOBJEXT","AOE","EXT","ACSX")
Call CLEAN_RECORD("AOBJEXT","AOE","EXT","ALBX")

# AOBJTXTD
Call CLEAN_RECORD("AOBJEXTD","AOD","EXT","ACSX")
Call CLEAN_RECORD("AOBJEXTD","AOD","EXT","ALBX")
End

# =================================================
# Remove records from APACKAGE
# =================================================
Subprog CLEAN_APACKAGE()
Call CLEAN_RECORD("APACKAGE","APACK","APACKCOD","TEST")
Call CLEAN_RECORD("APACKAGE","APACK","APACKCOD","TEST1")
Call CLEAN_RECORD("APACKAGE","APACK","APACKCOD","TEST2")
Call CLEAN_RECORD("APACKAGE","APACK","APACKCOD","TESTSHARED")
Call CLEAN_RECORD("APACKAGE","APACK","APACKCOD","TESTLINK")
End

# =================================================
# Remove records from AWRKLNK
# =================================================
Subprog CLEAN_AWRKLNK()
Call CLEAN_RECORD("AWRKLNK","AWM","MODELE","API_TEST1")
Call CLEAN_RECORD("AWRKLNK","AWM","MODELE","API_TEST2")
End

# =================================================
# Remove records from ANODEBDG
# =================================================
Subprog CLEAN_ANODEBDG()
Call CLEAN_RECORD("ANODEBDG","ANODEB","AREFBIND","API_TEST1")
End

# =================================================
# Remove activity codes
# =================================================
Subprog CLEAN_ACTIV()
# ACTIV
Call CLEAN_RECORD("ACTIV","ACV","CODACT","ZAPIF")
Call CLEAN_RECORD("ACTIV","ACV","CODACT","ZAPIL")
Call CLEAN_RECORD("ACTIV","ACV","CODACT","ZAPIS")

# ADOSACT
Call CLEAN_RECORD("ADOSACT","ADA","CODACT","ZAPIF")
Call CLEAN_RECORD("ADOSACT","ADA","CODACT","ZAPIL")
Call CLEAN_RECORD("ADOSACT","ADA","CODACT","ZAPIS")
End

# =================================================
# Remove workflow parameters
# =================================================
Subprog CLEAN_AWRKPAR()
# AWRKPAR
Call CLEAN_RECORD("AWRKPAR","AWA","CODE","TCYTEST")
# AWRKPARC
Call CLEAN_RECORD("AWRKPARC","AWC","CODE","TCYTEST")
# AWRKPARF
Call CLEAN_RECORD("AWRKPARF","AWF","CODE","TCYTEST")
# AWRKPARH
Call CLEAN_RECORD("AWRKPARH","AWH","CODE","TCYTEST")
# AWRKPARX
Call CLEAN_RECORD("AWRKPARX","AWX","CODE","TCYTEST")
End

#--------------------------------------------------
Subprog CLEAN_RECORD(TABLE,ABREV,KEYFIELD,RECORD)
Value Char TABLE, ABREV, KEYFIELD, RECORD
Local Integer  WST : WST=0
Local File = TABLE [ABREV]
Trbegin[ABREV]
Delete [ABREV] Where (evalue(KEYFIELD)=RECORD)
If fstat=0 : Commit : Else : Rollback : Endif
WST = fstat
LogicClose  File [ABREV]
Call CHECK_EQUAL("Clean"-RECORD-"in table"-TABLE-"Status:"-num$(WST),"Clean"-RECORD-"in table"-TABLE-"Status: 0") From AXUNIT
End